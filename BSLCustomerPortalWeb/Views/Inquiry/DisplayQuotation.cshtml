
@{
    ViewBag.Title = "DisplayQuotation";
}

@{
    <script>
        $(document).ready(function () {

            $('#tblDetail').hide();
            Fn_Get_Quotation_Report();

            $('#txtDate').datepicker({
                weekNumber: true,
                dateFormat: 'dd-M-yy'
            });

            Fn_Fill_AutoComplite('txtArticle', 'QuotationDetail', 'vArticle');
        });

        function Fn_Get_Quotation_Detail(id) {

            var clsQuotationList = {};
            clsQuotationList.QuotationId = id;

            $.ajax({
                type: "POST",
                url: '/Inquiry/Fn_Get_Quotation_Detail',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(clsQuotationList),
                success: function (data) {
                    $("#tbodyDetail").html('');
                    var obj = JSON.parse(data.message)
                    var html = ''; var html2 = '';
                    if (obj[0].vErrorMsg == "Success") {
                        for (var i = 0; i < obj.length; i++) {

                            var strPrice = obj[i].vPrice;
                            strPrice = strPrice.substring(4);
                            ddlCarrency = obj[i].vPrice;
                            ddlCarrency = ddlCarrency.substring(0, 3);

                            html += "<tr style='padding: 10px;'>";
                            html += "<td style='padding: 10px; font-size: 12px;'>" + obj[i].vArticle + "</td>";
                            html += "<td style='padding: 10px; font-size: 12px;'>" + obj[i].vBlend + "</td>";
                            html += "<td style='padding: 10px; font-size: 12px;'>" + obj[i].vWeight + "</td>";
                            html += "<td style='padding: 10px; font-size: 12px;'>" + obj[i].vWidth + "</td>";
                            html += "<td style='padding: 10px; font-size: 12px;'>" + strPrice + "</td>";
                            html += "<td style='padding: 10px; font-size: 12px;'>" + obj[i].vUnit + "</td>";
                            html += "<td style='padding: 10px; font-size: 12px;'>" + obj[i].vUnitType + "</td>";
                            html += "<td style='padding: 10px; font-size: 12px;'>" + obj[i].vPaymentTerms + "</td>";
                            html += "<td style='padding: 10px; font-size: 12px;'>" + obj[i].vDeliveryTerms + "</td>";
                            html += "</td>";
                        }

                        html2 += "<tr><td style='font-size: 12px; font-weight: 900;' colspan='9' class='text-center'> QuotationId: " + id + "</td></tr>";
                        $("#tbodyDetail").append(html2);
                    }
                    else {

                        html += "<tr><td style='font-size: 12px;' colspan='9' class='text-center'>" + obj[0].vErrorMsg + "</td></tr>";
                    }
                    $("#tbodyDetail").append(html);
                    $('#tblDetail').show();

                    $('#tdPrice').html('PRICE (' + ddlCarrency + ')');

                    $(".trColor").css("background-color", "");
                    $('#tr_' + id).css('background', '#8ec252');

                    $(".tdColor").css("font-weight", "");
                    $('#td_' + id).css('font-weight', '900');
                },
                error: function (err) {
                    alert(err);
                }
            });
        }

        function Fn_Print_Quotation(id) {
            window.location.href = "/Inquiry/PrintQuotation?Code='" + id + "'";
        }

        function Fn_Get_Quotation_Report() {

             $('#tblDetail').hide();

            var clsQuotationReport = {};
            clsQuotationReport.UserId = '@strUserId';
            clsQuotationReport.QuotationId = $('#txtQuotationId').val();
            clsQuotationReport.CustomerName = $('#txtCustomerName').val();
            clsQuotationReport.CreatedDate = $('#txtDate').val();
            clsQuotationReport.vArticle = $('#txtArticle').val();

        $.ajax({
            type: "POST",
            url: '/Inquiry/Fn_Get_Quotation_Report',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify(clsQuotationReport),
            success: function (data) {
                $("#tbody").html('');

                var obj = JSON.parse(data.message);
                var html = '';  var QOT = '';
                if (obj[0].vErrorMsg == "Success") {
                    for (var i = 0; i < obj.length; i++) {

                        if (QOT != obj[i].QuotationId) {
                            html += "<tr style='padding: 10px;' class='trColor' id='tr_" + obj[i].QuotationId + "'>";
                            html += "<td class='tdColor' id='td_" + obj[i].QuotationId + "' style='padding: 10px; font-size: 12px; cursor: pointer;'> <span onclick=Fn_Get_Quotation_Detail('" + obj[i].QuotationId + "');>" + obj[i].QuotationId + "</span></td>";
                            html += "<td style='padding: 10px; font-size: 12px;'>" + obj[i].CompanyName + "</td>";
                            html += "<td style='padding: 10px; font-size: 12px;'>" + obj[i].CustomerName + "</td>";
                            html += "<td style='padding: 10px; font-size: 12px;'>" + obj[i].ContactPerson + "</td>";
                            html += "<td style='padding: 10px; font-size: 12px;'>" + obj[i].EmailId + "</td>";
                            html += "<td style='padding: 10px; font-size: 12px;'>" + obj[i].CreatedDate + "</td>";
                            html += "<td style='padding: 10px; font-size: 12px; text-align: center;'><i class='fa fa-print 2x' onclick=Fn_Print_Quotation('" + obj[i].QuotationId + "');></i></td>";
                            html += "<td style='padding: 10px; font-size: 12px; text-align: center;'>";
                            html += "<i class='fa fa-edit 2x text-success' onclick=Fn_Edit_Quotation('" + obj[i].QuotationId + "');></i>";
                            html += "</td> ";
                            html += "</tr>";
                        }
                        QOT = obj[i].QuotationId;

                    }
                }
                else {
                    html += "<tr style='padding: 10px;'><td style='font-size: 12px;' colspan='7'class='text-center'>" + obj[0].vErrorMsg + "</td></tr>";
                }
                $("#tbody").append(html);
            },
            error: function (err) {
                alert(err);
            }
        });
        }

        function Fn_Fill_AutoComplite(ControlId, strTBLName, strFieldName) {

            $("#" + ControlId).autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '/Inquiry/Fn_Fill_AutoComplite',
                        type: "POST",
                        dataType: "json",
                        data: { Prefix: request.term, strTBLName: strTBLName, strFieldName: strFieldName },
                        success: function (data) {

                            var obj = JSON.parse(data.message);
                            response($.map(obj, function (item) {
                                return { label: item.vFieldName, value: item.vFieldName };
                            }));
                        }
                    });
                },
                select: function (event, ui) {
                    var str = ui.item.value;
                }
            });
        }

        function Fn_Edit_Quotation(id) {
            window.location.href = "/Inquiry/Quotation?Code='" + id + "'";
        }

    </script>
}

<section id="contact-page" class="pt-10 pb-10 gray-bg">
    <div class="container">
        <!-- Breadcrumb Begin -->
        <div class="row">
            <div class="col-lg-12">
                <div class="shop-top-search">
                    <div class="shop-bar">
                        <ul class="nav" id="myTab" role="tablist">
                            <li class="nav-item">
                                <a href="@Url.Action("DashBoard", "Home" )"><i class="fa fa-home"></i> Home</a>
                            </li>
                            <li class="nav-item" style="margin-left:-3%;font-size:16px;">
                                / Quotation Display
                            </li>
                            <li class="nav-item" style="margin-left:-3%;font-size:16px;">
                                / Quotation Display
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- Breadcrumb End -->
        <div class="container" style="margin-top:1%;">

            <div class="row">
                <div class="col-2">
                    <div class="form-group">
                        <label>Article </label>
                        <input type="text" id="txtArticle" name="txtArticle" class="form-control" style="font-size: 12px;" value="" />
                    </div>
                </div>
                @*<div class="col-2">
                    <div class="form-group">
                        <label>Quotation Id</label>
                        <input type="text" id="txtQuotationId" name="txtQuotationId" class="form-control" style="font-size: 12px;" value="" />
                    </div>
                </div>*@
                <div class="col-2">
                    <div class="form-group">
                        <label>Customer Name</label>
                        <input type="text" id="txtCustomerName" name="txtCustomerName" class="form-control" style="font-size: 12px;" value="" />
                    </div>
                </div>
                @*<div class="col-2">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="text" id="txtDate" name="txtDate" class="form-control" style="font-size: 12px;" value="" />
                    </div>
                </div>*@
                <div class="col-2">
                    <div class="form-group">
                        <input type="submit" id="btnSearch" name="btnSearch" value="Search" onclick="Fn_Get_Quotation_Report();" class="btn btn-success mt-4" />
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <table class="table table-striped table-hover" style="max-height: 350px; overflow: auto;">
                        <thead style="background-color: #08417B; color: white;">
                            <tr>
                                <td style="color: white; padding: 10px; font-size: 12px;">QUOTATION</td>
                                <td style="color: white; padding: 10px; font-size: 12px;">COMPANY</td>
                                <td style="color: white; padding: 10px; font-size: 12px;">CUSTOMER</td>
                                <td style="color: white; padding: 10px; font-size: 12px;">CONTACT PERSON</td>
                                <td style="color: white; padding: 10px; font-size: 12px;">EMAIL ID</td>
                                <td style="color: white; padding: 10px; font-size: 12px;">DATE</td>
                                <td style="color: white; padding: 10px; font-size: 12px;">PRINT</td>
                                <td style="color: white; padding: 10px; font-size: 12px;">ACTION</td>
                            </tr>
                        </thead>
                        <tbody id="tbody">
                        </tbody>
                    </table>
                </div>
                <div class="col-12">
                    <table class="table table-striped table-hover" id="tblDetail" style="display: none;">
                        <thead style="background-color: purple; color: white;">
                            <tr>
                                <td style="color: white; padding: 10px; font-size: 12px;">ARTICLE</td>
                                <td style="color: white; padding: 10px; font-size: 12px;">BLEND</td>
                                <td style="color: white; padding: 10px; font-size: 12px;">GSM</td>
                                <td style="color: white; padding: 10px; font-size: 12px;">WIDTH</td>
                                <td style="color: white; padding: 10px; font-size: 12px;" id="tdPrice"></td>
                                <td style="color: white; padding: 10px; font-size: 12px;">MCQ/MOQ</td>
                                <td style="color: white; padding: 10px; font-size: 12px;">UOM</td>
                                <td style="color: white; padding: 10px; font-size: 12px;">PAYMENT TERMS</td>
                                <td style="color: white; padding: 10px; font-size: 12px;">DELIVERY TERMS</td>
                            </tr>
                        </thead>
                        <tbody id="tbodyDetail">
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div> <!-- container -->
</section>